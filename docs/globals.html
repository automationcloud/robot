<!doctype html>
<html class="minimal no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Automation Cloud Robot API Reference | Automation Cloud Robot API Reference</title>
	<meta name="description" content="Automation Cloud Robot API Reference">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://fonts.googleapis.com/css?family=Barlow+Semi+Condensed:wght@400;600&display=fallback"
	rel="stylesheet"/>
	<link rel="stylesheet" href="assets/css/main.css"/>
	<link rel="stylesheet" href="assets/css/icons.css"/>
	<link rel="stylesheet" href="assets/css/hljs.css"/>
	<link rel="shortcut icon" href="assets/favicon.ico"/>
</head>
<body>
<div class="tsd-layout">
	<header class="tsd-header">
		<img class="tsd-logo"
		src="assets/images/ac-logo.svg"
		alt=""
		role="banner"
		title="Automation Cloud"/>
		<a class="tsd-header-link" href="index.html">
			Robot API Reference
		</a>
	</header>
	<div class="tsd-page">
		<nav class="tsd-navigation">
			<ul>
				<li class=" tsd-kind-enum">
					<a href="enums/jobcategory.html" class="tsd-kind-icon">Job<wbr>Category</a>
				</li>
				<li class=" tsd-kind-enum">
					<a href="enums/jobstate.html" class="tsd-kind-icon">Job<wbr>State</a>
				</li>
				<li class=" tsd-kind-class">
					<a href="classes/cloudjob.html" class="tsd-kind-icon">Cloud<wbr>Job</a>
				</li>
				<li class=" tsd-kind-class">
					<a href="classes/cloudrobot.html" class="tsd-kind-icon">Cloud<wbr>Robot</a>
				</li>
				<li class=" tsd-kind-class">
					<a href="classes/exception.html" class="tsd-kind-icon">Exception</a>
				</li>
				<li class=" tsd-kind-class">
					<a href="classes/job.html" class="tsd-kind-icon">Job</a>
				</li>
				<li class=" tsd-kind-class">
					<a href="classes/localjob.html" class="tsd-kind-icon">Local<wbr>Job</a>
				</li>
				<li class=" tsd-kind-class">
					<a href="classes/localrobot.html" class="tsd-kind-icon">Local<wbr>Robot</a>
				</li>
				<li class=" tsd-kind-class">
					<a href="classes/robot.html" class="tsd-kind-icon">Robot</a>
				</li>
				<li class=" tsd-kind-class">
					<a href="classes/vault.html" class="tsd-kind-icon">Vault</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/cloudrobotoptionalparams.html" class="tsd-kind-icon">Cloud<wbr>Robot<wbr>Optional<wbr>Params</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/cloudrobotrequiredparams.html" class="tsd-kind-icon">Cloud<wbr>Robot<wbr>Required<wbr>Params</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/exceptionspec.html" class="tsd-kind-icon">Exception<wbr>Spec</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/joberror.html" class="tsd-kind-icon">Job<wbr>Error</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/jobinitparams.html" class="tsd-kind-icon">Job<wbr>Init<wbr>Params</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/jobinput.html" class="tsd-kind-icon">Job<wbr>Input</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/jobinputobject.html" class="tsd-kind-icon">Job<wbr>Input<wbr>Object</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/joboutput.html" class="tsd-kind-icon">Job<wbr>Output</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/localrobotoptionalparams.html" class="tsd-kind-icon">Local<wbr>Robot<wbr>Optional<wbr>Params</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/localrobotrequiredparams.html" class="tsd-kind-icon">Local<wbr>Robot<wbr>Required<wbr>Params</a>
				</li>
				<li class=" tsd-kind-interface">
					<a href="interfaces/logger.html" class="tsd-kind-icon">Logger</a>
				</li>
				<li class=" tsd-kind-type-alias">
					<a href="globals.html#cloudrobotauthparams" class="tsd-kind-icon">Cloud<wbr>Robot<wbr>Auth<wbr>Params</a>
				</li>
				<li class=" tsd-kind-type-alias">
					<a href="globals.html#cloudrobotconfig" class="tsd-kind-icon">Cloud<wbr>Robot<wbr>Config</a>
				</li>
				<li class=" tsd-kind-type-alias">
					<a href="globals.html#cloudrobotoptions" class="tsd-kind-icon">Cloud<wbr>Robot<wbr>Options</a>
				</li>
				<li class=" tsd-kind-type-alias">
					<a href="globals.html#jobeventhandler" class="tsd-kind-icon">Job<wbr>Event<wbr>Handler</a>
				</li>
				<li class=" tsd-kind-type-alias">
					<a href="globals.html#localrobotconfig" class="tsd-kind-icon">Local<wbr>Robot<wbr>Config</a>
				</li>
				<li class=" tsd-kind-type-alias">
					<a href="globals.html#localrobotoptions" class="tsd-kind-icon">Local<wbr>Robot<wbr>Options</a>
				</li>
				<li class=" tsd-kind-type-alias">
					<a href="globals.html#localscriptinit" class="tsd-kind-icon">Local<wbr>Script<wbr>Init</a>
				</li>
			</ul>
		</nav>
		<main class="tsd-main">
			<div class="tsd-content-wrap">
				<div class="tsd-panel tsd-typography">
					<a href="#automation-cloud-robot-api" id="automation-cloud-robot-api" style="color: inherit; text-decoration: none;">
						<h1>Automation Cloud Robot API</h1>
					</a>
					<p><strong>Status: alpha (public APIs and interfaces are subject to change)</strong></p>
					<p>Robot is a client library for running <a href="https://github.com/automationcloud/autopilot">Autopilot</a> scripts.</p>
					<p>Principally, there are two different ways of running automations:</p>
					<ul>
						<li><p><a href="#running-locally">local</a> — the script is executed in the same process as your app; this approach requires Chromium browser running locally and is overall resource-intensive.</p>
						</li>
						<li><p><a href="#running-in-cloud">cloud</a> — the script is published to <a href="https://automationcloud.net">Automation Cloud</a> and is executed remotely by creating a Job; you app then receives notifications about state updates, emitted outputs, requested inputs, etc.</p>
						</li>
					</ul>
					<p>Robot provides a unified <a href="#job">Job</a> interface for running automations both locally and in the cloud. This approach encapsulates the complexity of setting up the Automation Engine, establishing connectivity to Chrome and wiring the code with different script lifecycle events, and allows switching transparently from local to cloud setup without modifying much of the business logic.</p>
					<p><img src="https://raw.githubusercontent.com/automationcloud/robot/main/resources/diagram.png" alt="Choosing Robot API Diagram"></p>
					<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
						<h2>Usage</h2>
					</a>
					<a href="#running-locally" id="running-locally" style="color: inherit; text-decoration: none;">
						<h3>Running locally</h3>
					</a>
					<p>Local execution refers to a technique where the script is loaded (from file, database or other source) and executed on the same machine as your app. Chromium web browser is required to run the jobs locally.</p>
					<pre><code class="language-ts"><span class="hljs-keyword">import</span> { LocalRobot } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@automationcloud/local-robot&#x27;</span>;

<span class="hljs-keyword">const</span> robot = <span class="hljs-keyword">new</span> LocalRobot({
    <span class="hljs-attr">script</span>: <span class="hljs-string">&#x27;/path/to/my/script.json&#x27;</span>,
    <span class="hljs-attr">chromePath</span>: <span class="hljs-string">&#x27;/path/to/chromium/executable&#x27;</span>,
});

<span class="hljs-keyword">const</span> job = <span class="hljs-keyword">await</span> robot.createJob({
    <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;https://store-to-scrape.com&#x27;</span>,
        <span class="hljs-comment">// ...</span>
    }
});

<span class="hljs-keyword">const</span> [products, deliveryOptions] = <span class="hljs-keyword">await</span> job.waitForOutputs(<span class="hljs-string">&#x27;products&#x27;</span>, <span class="hljs-string">&#x27;deliveryOptions&#x27;</span>);

<span class="hljs-keyword">await</span> job.waitForCompletion();</code></pre>
					<p>Local execution is facilitated by <code>@automationcloud/local-robot</code> package.
					Under the hood, <code>robot</code> instance creates automation jobs which are executed by its embedded <a href="https://github.com/automationcloud/autopilot">Autopilot Engine</a>.</p>
					<a href="#chrome-setup" id="chrome-setup" style="color: inherit; text-decoration: none;">
						<h3>Chrome Setup</h3>
					</a>
					<p>Local setup requires <a href="https://www.chromium.org/">Chromium</a> executable to be available, so that the Robot can launch it with appropriate CLI flags (the most notable one is <code>--remote-debugging-port</code> which allows connecting to Chromium via Chrome DevTools Protocol).</p>
					<p><strong>Note:</strong> It is strongly recommended to avoid using your regular Chrome browser for performing automations. Doing so may cause data loss (Engine automatically cleans up browsing data to avoid polluted state) and may otherwise compromise your browsing data due to using unsafe CLI arguments. Additionally, your automation scripts will assume full control over browser lifecycle, which is simply not convenient.</p>
					<p>Use following links to download Chromium snapshots for your operating system:</p>
					<ul>
						<li><a href="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/768968/">Mac</a></li>
						<li><a href="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win_x64/768966/">Windows</a></li>
						<li><a href="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Linux_x64/768968/">Linux</a></li>
					</ul>
					<p>It is also possible to run Robot in a Docker image, all you need to do is to make sure that Node.js and Chromium are available.
					We also maintain <a href="https://github.com/automationcloud/chrome-image">our own image</a> which can be used either directly via <code>FROM automationcloud/chrome:84</code> or by adapting the <a href="https://github.com/automationcloud/chrome-image/blob/master/Dockerfile">Dockerfile</a> to specific needs.</p>
					<a href="#running-in-cloud" id="running-in-cloud" style="color: inherit; text-decoration: none;">
						<h3>Running in Cloud</h3>
					</a>
					<p>To run your automations in the Automation Cloud, all you have to do is to change <code>LocalRobot</code> to <code>CloudRobot</code>:</p>
					<pre><code class="language-ts"><span class="hljs-keyword">import</span> { CloudRobot } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@automationcloud/cloud-robot&#x27;</span>;

<span class="hljs-keyword">const</span> robot = <span class="hljs-keyword">new</span> CloudRobot({
    <span class="hljs-attr">serviceId</span>: <span class="hljs-string">&#x27;uuid&#x27;</span>, <span class="hljs-comment">// Automation Cloud Service id where your script is published</span>
    <span class="hljs-attr">auth</span>: {            <span class="hljs-comment">// OAuth2 settings of your application</span>
        <span class="hljs-attr">clientId</span>: <span class="hljs-string">&#x27;your-app-client-id&#x27;</span>,
        <span class="hljs-attr">clientSecret</span>: process.env.AC_CLIENT_SECRET,
    }
});

<span class="hljs-keyword">const</span> job = <span class="hljs-keyword">await</span> robot.createJob(<span class="hljs-comment">/*...*/</span>); <span class="hljs-comment">// The Job part does not change.</span></code></pre>
					<a href="#job" id="job" style="color: inherit; text-decoration: none;">
						<h2>Job</h2>
					</a>
					<p>Job is a high level abstraction that allows you to think about your automations in terms of inputs, outputs and state updates.</p>
					<a href="#creating-the-job" id="creating-the-job" style="color: inherit; text-decoration: none;">
						<h3>Creating the job</h3>
					</a>
					<pre><code class="language-ts"><span class="hljs-keyword">const</span> job = <span class="hljs-keyword">await</span> robot.createJob({
    <span class="hljs-attr">category</span>: <span class="hljs-string">&#x27;test&#x27;</span> | <span class="hljs-string">&#x27;live&#x27;</span>, <span class="hljs-comment">// optional, used to filter test jobs in dashboard</span>
    <span class="hljs-attr">input</span>: {                   <span class="hljs-comment">// optional, starts the job with pre-supplied inputs</span>
        <span class="hljs-attr">foo</span>: { <span class="hljs-attr">arbitrary</span>: <span class="hljs-string">&#x27;data&#x27;</span> }
    },
});</code></pre>
					<p>Job runs immediately after creation.</p>
					<p>Note: it is not required to pre-supply all inputs that script expects. Whenever script uses an input that hasn&#39;t been provided, it will produce an <code>awaitingInput</code> event and will only continue once the requested input is submitted. See <a href="#deferred-inputs">deferred inputs</a> for more information.</p>
					<a href="#waiting-for-completion" id="waiting-for-completion" style="color: inherit; text-decoration: none;">
						<h3>Waiting for completion</h3>
					</a>
					<p>The Robot API tracks job lifecycle events up to the point when the job is either finished successfully or failed with an error. <code>waitForCompletion</code> resolves or rejects when the tracking is over.</p>
					<pre><code class="language-ts"><span class="hljs-keyword">await</span> job.waitForCompletion();
<span class="hljs-comment">// The promise is resolved once the job reaches a `success` state</span>
<span class="hljs-comment">// (e.g. a `success` context is reached).</span>
<span class="hljs-comment">// The promise is rejected if the error occurs.</span></code></pre>
					<p><strong>Note</strong>: always make sure to include <code>await job.waitForCompletion()</code> to prevent dangling promises or unhandled promise rejections.</p>
					<a href="#waiting-for-outputs" id="waiting-for-outputs" style="color: inherit; text-decoration: none;">
						<h3>Waiting for outputs</h3>
					</a>
					<p>Outputs provide a mechanism to receive the results that script produces. This can be the results of web page scraping, or collected options, or any other information retrieved by the script.</p>
					<p>Robot API offers a convenient way of waiting for the outputs you expect from your script:</p>
					<pre><code class="language-ts"><span class="hljs-comment">// The promise will resolve once all specified outputs are emitted by script</span>
<span class="hljs-keyword">const</span> [products, deliveryOptions] = <span class="hljs-keyword">await</span> job.waitForOutputs(<span class="hljs-string">&#x27;products&#x27;</span>, <span class="hljs-string">&#x27;deliveryOptions&#x27;</span>);</code></pre>
					<p>In other scenarios it might be more practical to use event-based API to get notified when a particular output is emitted:</p>
					<pre><code class="language-ts">job.onOutput(<span class="hljs-string">&#x27;myOutputKey&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {

});</code></pre>
					<a href="#deferred-inputs" id="deferred-inputs" style="color: inherit; text-decoration: none;">
						<h3>Deferred inputs</h3>
					</a>
					<p>Inputs provide a mechanism of passing the information to the script.</p>
					<p>Some inputs are known upfront so it makes sense to specify them when <a href="#creating-the-job">the job is created</a>.</p>
					<p>Other inputs cannot be pre-supplied. For example, the website may ask its users to select a delivery option — in such case the script would first collect the available options and emit them as an output and subsequently request the selected option via an input.</p>
					<pre><code class="language-ts">job.onAwaitingInput(<span class="hljs-string">&#x27;selectedDeliveryOption&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// Callback is asynchronous, so you can fetch data from database,</span>
    <span class="hljs-comment">// send http requests or obtain job outputs.</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">option</span>: <span class="hljs-number">3</span> };
});</code></pre>
					<p>A special <code>*</code> key can be used to subscribe to all requested inputs with a single handler:</p>
					<pre><code class="language-ts">job.onAwaitingInput(<span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-function"><span class="hljs-params">requestedInputKey</span> =&gt;</span> {
    <span class="hljs-comment">// ...</span>
});</code></pre>
					<p>If the handler doesn&#39;t return a value, the input is not submitted:</p>
					<pre><code class="language-ts">job.onAwaitingInput(<span class="hljs-string">&#x27;selectedDeliveryOption&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// No return, so input submission does not occur</span>
});</code></pre>
					<p>Inputs can also be submitted individually at any point in time whilst the job is still running:</p>
					<pre><code class="language-ts"><span class="hljs-keyword">await</span> job.submitInput(<span class="hljs-string">&#x27;selectedDeliveryOption&#x27;</span>, { <span class="hljs-attr">option</span>: <span class="hljs-number">3</span> });</code></pre>
					<a href="#events" id="events" style="color: inherit; text-decoration: none;">
						<h3>Events</h3>
					</a>
					<p>You can also subscribe to various job lifecycle events.</p>
					<pre><code class="language-ts">job.onSuccess(<span class="hljs-keyword">async</span> () =&gt; { ... });
job.onFail(<span class="hljs-keyword">async</span> err =&gt; { ...});
job.onOutput(outputKey, <span class="hljs-keyword">async</span> outputData =&gt; { ... });
job.onAnyOutput(<span class="hljs-keyword">async</span> (outputKey, outputData) =&gt; { ... });
job.onStateChanged(<span class="hljs-keyword">async</span> newState =&gt; { ... });</code></pre>
					<p>To unsubscribe for event:</p>
					<pre><code class="language-ts"><span class="hljs-keyword">const</span> unsubscribe = job.onSuccess(<span class="hljs-function">() =&gt;</span> { ... });
<span class="hljs-comment">// ...</span>
unsubscribe();</code></pre>
					<p>Note 1: All callbacks are asynchronous. Exception thrown inside a callback will result in an unhandled rejection.</p>
					<p>Note 2: It is advisable to not depend on the order of the events, because they can vary between different engine versions, between scripts and even within one script (i.e. depending on some script logic).</p>
					<p>Note 3: As with all event-based APIs it is possible to miss the event if the subscription is done after the event has already emitted.</p>
					<a href="#license" id="license" style="color: inherit; text-decoration: none;">
						<h2>License</h2>
					</a>
					<p>See <a href="LICENSE.md">LICENSE</a>.</p>
				</div>
			</div>
		</main>
	</div>
</div>
</body>
</html>